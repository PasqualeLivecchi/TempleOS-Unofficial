<!DOCTYPE HTML>
<html style="background-color:#FFFFFF;">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=US-ASCII">
<title>The Temple Operating System</title>
<meta name="keywords" content="Operating System,64-Bit,64 Bit,Temple,OS,TempleOS,Free,Open Source,Public Domain,x86_64">
<meta name="generator" content="TempleOS (U) V5.04">
<style type="text/css">
.cB0{color:#000000;background-color:#55ffff;}
.cB1{color:#0000aa;background-color:#55ffff;}
.cB2{color:#00aa00;background-color:#55ffff;}
.cB3{color:#00aaaa;background-color:#55ffff;}
.cB4{color:#aa0000;background-color:#55ffff;}
.cB5{color:#aa00aa;background-color:#55ffff;}
.cB6{color:#aa5500;background-color:#55ffff;}
.cB7{color:#aaaaaa;background-color:#55ffff;}
.cB9{color:#5555ff;background-color:#55ffff;}
.cBB{color:#55ffff;background-color:#55ffff;}
.cF0{color:#000000;background-color:#ffffff;}
.cF1{color:#0000aa;background-color:#ffffff;}
.cF2{color:#00aa00;background-color:#ffffff;}
.cF3{color:#00aaaa;background-color:#ffffff;}
.cF4{color:#aa0000;background-color:#ffffff;}
.cF5{color:#aa00aa;background-color:#ffffff;}
.cF6{color:#aa5500;background-color:#ffffff;}
.cF7{color:#aaaaaa;background-color:#ffffff;}
.cF8{color:#555555;background-color:#ffffff;}
.cF9{color:#5555ff;background-color:#ffffff;}
.cFA{color:#55ff55;background-color:#ffffff;}
.cFB{color:#55ffff;background-color:#ffffff;}
.cFC{color:#ff5555;background-color:#ffffff;}
.cFD{color:#ff55ff;background-color:#ffffff;}
.cFE{color:#ffff55;background-color:#ffffff;}
.cFF{color:#ffffff;background-color:#ffffff;}
</style>
</head>
<body style="background-color:#55FFFF; border-style:solid;
	  border-width:8px; border-color:#0000AA;
	  margin-left:auto; margin-right:auto; width:800px; ">
<pre style="font-family:courier;font-size:10pt">
<div style="margin-left:auto; margin-right:auto; width: 640px;">
<a name="l1"></a><span class=cB0>#</span><span class=cB1>help_index</span><span class=cB0> </span><span class=cB6>&quot;Debugging/IDE&quot;</span><span class=cB0>
<a name="l2"></a>
<a name="l3"></a>#</span><span class=cB1>define</span><span class=cB0> IDET_GO                 1
<a name="l4"></a>#</span><span class=cB1>define</span><span class=cB0> IDET_STEP_INTO          2
<a name="l5"></a>#</span><span class=cB1>define</span><span class=cB0> IDET_STEP_OVER          3
<a name="l6"></a>
<a name="l7"></a></span><span class=cB1>class</span><span class=cB0> CIDE
<a name="l8"></a>{
<a name="l9"></a>  </span><span class=cB9>I64</span><span class=cB0> type;
<a name="l10"></a>  </span><span class=cB1>U8</span><span class=cB0> *cur_line,*next_line;
<a name="l11"></a>  </span><span class=cB1>U8</span><span class=cB0> *call_bpt;
<a name="l12"></a>  </span><span class=cB1>Bool</span><span class=cB0> existing_bpt;
<a name="l13"></a>};
<a name="l14"></a>
<a name="l15"></a></span><span class=cB1>U0</span><span class=cB0> IDEWaitParent()
<a name="l16"></a>{
<a name="l17"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task;
<a name="l18"></a>  </span><span class=cB1>while</span><span class=cB0> (!</span><span class=cB5>IsSuspended</span><span class=cB7>(</span><span class=cB0>task</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l19"></a>        !</span><span class=cB5>Bt</span><span class=cB7>(</span><span class=cB0>&amp;task-&gt;task_flags,</span><span class=cB3>TASKf_IDLE</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l20"></a>        !</span><span class=cB5>Bt</span><span class=cB7>(</span><span class=cB0>&amp;task-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB7>)</span><span class=cB0>)
<a name="l21"></a>    </span><span class=cB5>Yield</span><span class=cB0>;
<a name="l22"></a>}
<a name="l23"></a>
<a name="l24"></a></span><span class=cB1>public</span><span class=cB0> </span><span class=cB9>CHashFun</span><span class=cB0> *DbgFunFind(</span><span class=cB9>CDoc</span><span class=cB0> *doc,</span><span class=cB9>I64</span><span class=cB0> line_offset=0)
<a name="l25"></a>{
<a name="l26"></a>  </span><span class=cB1>U8</span><span class=cB0> st[256],*filename=doc-&gt;filename.name;
<a name="l27"></a>  </span><span class=cB9>I64</span><span class=cB0> i,line=doc-&gt;cur_entry-&gt;y+1+line_offset;
<a name="l28"></a>  </span><span class=cB9>CHashTable</span><span class=cB0> *h=</span><span class=cB5>Fs</span><span class=cB0>-&gt;hash_table;
<a name="l29"></a>  </span><span class=cB9>CHashSrcSym</span><span class=cB0> *tmph;
<a name="l30"></a>  </span><span class=cB9>CDbgInfo</span><span class=cB0> *dbg_info;
<a name="l31"></a>  </span><span class=cB1>while</span><span class=cB0> (h) </span><span class=cB7>{</span><span class=cB0>
<a name="l32"></a>    </span><span class=cB1>for</span><span class=cB0> (i=0;i&lt;=h-&gt;mask;i++) {
<a name="l33"></a>      tmph=h-&gt;body[i];
<a name="l34"></a>      </span><span class=cB1>while</span><span class=cB0> (tmph) </span><span class=cB7>{</span><span class=cB0>
<a name="l35"></a>        </span><span class=cB1>if</span><span class=cB0> (tmph-&gt;type&amp;</span><span class=cB7>(</span><span class=cB3>HTT_FUN</span><span class=cB0>|</span><span class=cB3>HTT_EXPORT_SYS_SYM</span><span class=cB7>)</span><span class=cB0>)
<a name="l36"></a>          dbg_info=tmph-&gt;dbg_info;
<a name="l37"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l38"></a>          dbg_info=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l39"></a>        </span><span class=cB1>if</span><span class=cB0> (dbg_info) {
<a name="l40"></a>          </span><span class=cB5>StrCpy</span><span class=cB0>(st,tmph-&gt;src_link);
<a name="l41"></a>          </span><span class=cB5>StrFirstRem</span><span class=cB0>(st,</span><span class=cB6>&quot;:&quot;</span><span class=cB0>);
<a name="l42"></a>          </span><span class=cB5>StrLastRem</span><span class=cB0>(st,</span><span class=cB6>&quot;,&quot;</span><span class=cB0>);
<a name="l43"></a>          </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>StrCmp</span><span class=cB7>(</span><span class=cB0>st,filename</span><span class=cB7>)</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l44"></a>            </span><span class=cB1>if</span><span class=cB0> (dbg_info-&gt;min_line&lt;=line&lt;=dbg_info-&gt;max_line)
<a name="l45"></a>              </span><span class=cB1>return</span><span class=cB0> tmph;
<a name="l46"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l47"></a>        }
<a name="l48"></a>        tmph=tmph-&gt;next;
<a name="l49"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l50"></a>    }
<a name="l51"></a>    h=h-&gt;next;
<a name="l52"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l53"></a>  </span><span class=cB1>return</span><span class=cB0> </span><span class=cB3>NULL</span><span class=cB0>;
<a name="l54"></a>}
<a name="l55"></a>
<a name="l56"></a></span><span class=cB1>U0</span><span class=cB0> WatchLocals()
<a name="l57"></a>{
<a name="l58"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task,*dbg_task;
<a name="l59"></a>  </span><span class=cB9>CDoc</span><span class=cB0> *doc;
<a name="l60"></a>  </span><span class=cB9>CHashFun</span><span class=cB0> *tmpf,*tmpf1;
<a name="l61"></a>  </span><span class=cB9>I64</span><span class=cB0> sc,ch,</span><span class=cB1>offset</span><span class=cB0>,rip;
<a name="l62"></a>  </span><span class=cB1>F64</span><span class=cB0> timeout;
<a name="l63"></a>  </span><span class=cB1>U8</span><span class=cB0> **rbp,**ptr;
<a name="l64"></a>  </span><span class=cB1>while</span><span class=cB0> (</span><span class=cB3>TRUE</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l65"></a>    IDEWaitParent;
<a name="l66"></a>    </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>TaskValidate</span><span class=cB7>(</span><span class=cB0>dbg_task=task-&gt;dbg_task</span><span class=cB7>)</span><span class=cB0>)
<a name="l67"></a>      </span><span class=cB5>Exit</span><span class=cB0>;
<a name="l68"></a>    </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>ScanKey</span><span class=cB7>(</span><span class=cB0>&amp;ch,&amp;sc,</span><span class=cB3>TRUE</span><span class=cB7>)</span><span class=cB0>) {
<a name="l69"></a>      timeout=</span><span class=cB5>tS</span><span class=cB0>+4.0;
<a name="l70"></a>      </span><span class=cB1>do</span><span class=cB0> </span><span class=cB7>{</span><span class=cB0>
<a name="l71"></a>        </span><span class=cB1>if</span><span class=cB0> (ch==</span><span class=cB3>CH_SHIFT_ESC</span><span class=cB0> || ch==</span><span class=cB3>CH_ESC</span><span class=cB0>)
<a name="l72"></a>          </span><span class=cB5>Exit</span><span class=cB0>;
<a name="l73"></a>        </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>ScanKey</span><span class=cB7>(</span><span class=cB0>&amp;ch,&amp;sc,</span><span class=cB3>TRUE</span><span class=cB7>)</span><span class=cB0>)
<a name="l74"></a>          timeout=</span><span class=cB5>tS</span><span class=cB0>+4.0;
<a name="l75"></a>        </span><span class=cB5>Refresh</span><span class=cB0>;
<a name="l76"></a>      </span><span class=cB7>}</span><span class=cB0> </span><span class=cB1>while</span><span class=cB0> (</span><span class=cB5>tS</span><span class=cB0>&lt;timeout);
<a name="l77"></a>    } </span><span class=cB1>else</span><span class=cB0> {
<a name="l78"></a>      IDEWaitParent;
<a name="l79"></a>      </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>TaskValidate</span><span class=cB7>(</span><span class=cB0>dbg_task=task-&gt;dbg_task</span><span class=cB7>)</span><span class=cB0>)
<a name="l80"></a>        </span><span class=cB5>Exit</span><span class=cB0>;
<a name="l81"></a>      </span><span class=cB5>DocDblBufStart</span><span class=cB0>;
<a name="l82"></a>      </span><span class=cB1>if</span><span class=cB0> (doc=</span><span class=cB5>DocPut</span><span class=cB7>(</span><span class=cB0>dbg_task</span><span class=cB7>)</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l83"></a>        </span><span class=cB1>if</span><span class=cB0> (tmpf=DbgFunFind</span><span class=cB7>(</span><span class=cB0>doc,0</span><span class=cB7>)</span><span class=cB0>) {
<a name="l84"></a>          </span><span class=cB6>&quot;$WW,1$&quot;</span><span class=cB0>;
<a name="l85"></a>          rbp=task-&gt;rbp;
<a name="l86"></a>          rip=task-&gt;rip;
<a name="l87"></a>          </span><span class=cB1>while</span><span class=cB0> (</span><span class=cB3>TRUE</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l88"></a>            tmpf1=</span><span class=cB5>FunSegFind</span><span class=cB0>(rip,&amp;</span><span class=cB1>offset</span><span class=cB0>);
<a name="l89"></a>            </span><span class=cB1>break</span><span class=cB0>; </span><span class=cB2>//TODO: load reg vars for higher level subroutines</span><span class=cB0>
<a name="l90"></a>            </span><span class=cB1>if</span><span class=cB0> (tmpf==tmpf1)
<a name="l91"></a>              </span><span class=cB1>break</span><span class=cB0>;
<a name="l92"></a>            </span><span class=cB1>else</span><span class=cB0> {
<a name="l93"></a>              </span><span class=cB1>if</span><span class=cB0> (rbp&gt;=*rbp)
<a name="l94"></a>                </span><span class=cB1>break</span><span class=cB0>;
<a name="l95"></a>              ptr=rbp+1;
<a name="l96"></a>              rbp=*rbp;
<a name="l97"></a>              rip=*ptr;
<a name="l98"></a>              </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>ChkOnStk</span><span class=cB7>(</span><span class=cB0>rbp,task</span><span class=cB7>)</span><span class=cB0>)
<a name="l99"></a>                </span><span class=cB1>break</span><span class=cB0>;
<a name="l100"></a>            }
<a name="l101"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l102"></a>          </span><span class=cB1>if</span><span class=cB0> (tmpf==tmpf1)
<a name="l103"></a>            </span><span class=cB5>FunRep</span><span class=cB0>(tmpf-&gt;str,rbp,1,task);
<a name="l104"></a>        }
<a name="l105"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l106"></a>      </span><span class=cB5>DocDblBufEnd</span><span class=cB0>;
<a name="l107"></a>      </span><span class=cB5>Refresh</span><span class=cB0>;
<a name="l108"></a>    }
<a name="l109"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l110"></a>}
<a name="l111"></a>
<a name="l112"></a></span><span class=cB1>public</span><span class=cB0> </span><span class=cB1>U0</span><span class=cB0> IDE(</span><span class=cB1>U8</span><span class=cB0> *filename)
<a name="l113"></a></span><span class=cB2>//Spawns a child process which has</span><span class=cB0>
<a name="l114"></a></span><span class=cB2>//access to parents syms. Can be used</span><span class=cB0>
<a name="l115"></a></span><span class=cB2>//to debug parent.</span><span class=cB0>
<a name="l116"></a>{
<a name="l117"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task;
<a name="l118"></a>  </span><span class=cB1>U8</span><span class=cB0> *fn1=</span><span class=cB5>ExtDft</span><span class=cB0>(filename,</span><span class=cB6>&quot;HC.Z&quot;</span><span class=cB0>),
<a name="l119"></a>        *fn2=</span><span class=cB5>FileNameAbs</span><span class=cB0>(fn1);
<a name="l120"></a>
<a name="l121"></a>  </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>PopUpCancelOk</span><span class=cB7>(</span><span class=cB6>&quot;$BK,1$$RED$TempleOS IDE Debugger$FG$$BK,0$\n&quot;</span><span class=cB0>
<a name="l122"></a>        </span><span class=cB6>&quot;Do not use this on files that run when included.\n&quot;</span><span class=cB0>
<a name="l123"></a>        </span><span class=cB6>&quot;\nTo use:\n&quot;</span><span class=cB0>
<a name="l124"></a>        </span><span class=cB6>&quot;  1) Set a break-point in the editor window.\n&quot;</span><span class=cB0>
<a name="l125"></a>        </span><span class=cB6>&quot;  2) Run program from cmd line.\n\n&quot;</span><span class=cB0>
<a name="l126"></a>        </span><span class=cB6>&quot;$GREEN$F5$FG$\t\tGo\n&quot;</span><span class=cB0>
<a name="l127"></a>        </span><span class=cB6>&quot;$GREEN$F10$FG$\t\tStep Over\n&quot;</span><span class=cB0>
<a name="l128"></a>        </span><span class=cB6>&quot;$GREEN$F11$FG$\t\tStep Into\n&quot;</span><span class=cB0>
<a name="l129"></a>        </span><span class=cB6>&quot;$GREEN$F9$FG$\t\tToggle Break Point\n&quot;</span><span class=cB0>
<a name="l130"></a>        </span><span class=cB6>&quot;$GREEN$SHIFT-F9$FG$\tClear All Break Points\n&quot;</span><span class=cB0>
<a name="l131"></a>        </span><span class=cB6>&quot;\n\n\nNote: I don't use this debugger because\n&quot;</span><span class=cB0>
<a name="l132"></a>        </span><span class=cB6>&quot;I'm always doing multitasking stuff, \n&quot;</span><span class=cB0>
<a name="l133"></a>        </span><span class=cB6>&quot;kernel stuff and multicore stuff.  Also,\n&quot;</span><span class=cB0>
<a name="l134"></a>        </span><span class=cB6>&quot;you can't debug code in the window\n&quot;</span><span class=cB0>
<a name="l135"></a>        </span><span class=cB6>&quot;mgr callbacks.  It works on really\n&quot;</span><span class=cB0>
<a name="l136"></a>        </span><span class=cB6>&quot;simple stuff, sort-of.\n\n&quot;</span><span class=cB0>
<a name="l137"></a>        </span><span class=cB6>&quot;I recommend making use of:\n&quot;</span><span class=cB0>
<a name="l138"></a>        </span><span class=cB6>&quot;</span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KernelB.html#l209"><span class=cB4>progress1</span></a><span class=cB6>-</span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KernelB.html#l227"><span class=cB4>progress4</span></a><span class=cB6>,\t\t-- glbl I64 vars shown on wallpaper\n&quot;</span><span class=cB0>
<a name="l139"></a>        </span><span class=cB6>&quot;</span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KDbg.html#l217"><span class=cB4>RawPrint</span></a><span class=cB6>(), </span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KDbg.html#l234"><span class=cB4>RawD</span></a><span class=cB6>(), </span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KDbg.html#l250"><span class=cB4>RawDm</span></a><span class=cB6>()\t-- raw text output for a time\n&quot;</span><span class=cB0>
<a name="l140"></a>        </span><span class=cB6>&quot;</span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KMisc.html#l237"><span class=cB4>Beep</span></a><span class=cB6>(), </span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KMisc.html#l179"><span class=cB4>Snd</span></a><span class=cB6>()\t\t\t-- sound\n&quot;</span><span class=cB0>
<a name="l141"></a>        </span><span class=cB6>&quot;</span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/Job.html#l423"><span class=cB4>AdamLog</span></a><span class=cB6>(), </span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/Job.html#l433"><span class=cB4>AdamErr</span></a><span class=cB6>()\t\t-- print to adam task's window\n&quot;</span><span class=cB0>
<a name="l142"></a>        </span><span class=cB6>&quot;</span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KMisc.html#l280"><span class=cB4>SysDbg</span></a><span class=cB6>(), </span><a href="https://tosrevive.github.io/TempleOS-Unofficial/Wb/Kernel/KMisc.html#l285"><span class=cB4>IsSysDbg</span></a><span class=cB6>()\t\t-- just a flag\n\n&quot;</span><span class=cB7>)</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l143"></a>    </span><span class=cB5>WinHorz</span><span class=cB0>(1,</span><span class=cB3>TEXT_COLS</span><span class=cB0>&gt;&gt;1-1);
<a name="l144"></a>    </span><span class=cB5>WinVert</span><span class=cB0>(2,</span><span class=cB3>TEXT_ROWS</span><span class=cB0>-2);
<a name="l145"></a>    </span><span class=cB5>LBts</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;display_flags,</span><span class=cB3>DISPLAYf_CHILDREN_NOT_ON_TOP</span><span class=cB0>);
<a name="l146"></a>
<a name="l147"></a>    task=</span><span class=cB5>Spawn</span><span class=cB0>(&amp;</span><span class=cB5>UserCmdLine</span><span class=cB0>,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Debug&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l148"></a>    </span><span class=cB5>TaskWait</span><span class=cB0>(task);
<a name="l149"></a>    </span><span class=cB5>WinHorz</span><span class=cB0>(</span><span class=cB3>TEXT_COLS</span><span class=cB0>&gt;&gt;1+1,</span><span class=cB3>TEXT_COLS</span><span class=cB0>-2,task);
<a name="l150"></a>    </span><span class=cB5>WinVert</span><span class=cB0>(12,</span><span class=cB3>TEXT_ROWS</span><span class=cB0>-2,task);
<a name="l151"></a>    </span><span class=cB5>XTalk</span><span class=cB0>(task,</span><span class=cB6>&quot;Ed(\&quot;%s\&quot;);\n&quot;</span><span class=cB0>,fn2);
<a name="l152"></a>
<a name="l153"></a>    </span><span class=cB5>Fs</span><span class=cB0>-&gt;dbg_task=task;
<a name="l154"></a>
<a name="l155"></a>    task=</span><span class=cB5>Spawn</span><span class=cB0>(&amp;</span><span class=cB5>UserCmdLine</span><span class=cB0>,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Watch&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l156"></a>    </span><span class=cB5>TaskWait</span><span class=cB0>(task);
<a name="l157"></a>    </span><span class=cB5>WinHorz</span><span class=cB0>(</span><span class=cB3>TEXT_COLS</span><span class=cB0>&gt;&gt;1+1,</span><span class=cB3>TEXT_COLS</span><span class=cB0>-2,task);
<a name="l158"></a>    </span><span class=cB5>WinVert</span><span class=cB0>(2,10,task);
<a name="l159"></a>    </span><span class=cB5>XTalk</span><span class=cB0>(task,</span><span class=cB6>&quot;WatchLocals;\n&quot;</span><span class=cB0>);
<a name="l160"></a>    </span><span class=cB5>ExeFile</span><span class=cB0>(fn2);
<a name="l161"></a>    </span><span class=cB5>Free</span><span class=cB0>(fn1);
<a name="l162"></a>    </span><span class=cB5>Free</span><span class=cB0>(fn2);
<a name="l163"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l164"></a>}
<a name="l165"></a>
<a name="l166"></a></span><span class=cB9>I64</span><span class=cB0> IDELineAdd(</span><span class=cB9>CDbgInfo</span><span class=cB0> *dbg_info,</span><span class=cB9>I64</span><span class=cB0> line)
<a name="l167"></a>{
<a name="l168"></a>  </span><span class=cB9>I64</span><span class=cB0> max=dbg_info-&gt;max_line-dbg_info-&gt;min_line;
<a name="l169"></a>  line-=dbg_info-&gt;min_line;
<a name="l170"></a>  </span><span class=cB1>if</span><span class=cB0> (line&lt;0)
<a name="l171"></a>    </span><span class=cB1>return</span><span class=cB0> IDELineAdd(dbg_info,dbg_info-&gt;min_line);
<a name="l172"></a>  </span><span class=cB1>while</span><span class=cB0> (!dbg_info-&gt;body[line] &amp;&amp; line&lt;=max)
<a name="l173"></a>    line++;
<a name="l174"></a>  </span><span class=cB1>return</span><span class=cB0> dbg_info-&gt;body[line];
<a name="l175"></a>}
<a name="l176"></a>
<a name="l177"></a></span><span class=cB9>I64</span><span class=cB0> IDERIPLineNum(</span><span class=cB9>CDoc</span><span class=cB0> *doc,</span><span class=cB1>U8</span><span class=cB0> *rip)
<a name="l178"></a>{
<a name="l179"></a>  </span><span class=cB1>U8</span><span class=cB0> st[256],*filename=doc-&gt;filename.name;
<a name="l180"></a>  </span><span class=cB9>I64</span><span class=cB0> i,line;
<a name="l181"></a>  </span><span class=cB9>CHashTable</span><span class=cB0> *h=</span><span class=cB5>Fs</span><span class=cB0>-&gt;hash_table;
<a name="l182"></a>  </span><span class=cB9>CHashFun</span><span class=cB0> *tmpf;
<a name="l183"></a>  </span><span class=cB9>CDbgInfo</span><span class=cB0> *dbg_info;
<a name="l184"></a>  </span><span class=cB1>while</span><span class=cB0> (h) </span><span class=cB7>{</span><span class=cB0>
<a name="l185"></a>    </span><span class=cB1>for</span><span class=cB0> (i=0;i&lt;=h-&gt;mask;i++) {
<a name="l186"></a>      tmpf=h-&gt;body[i];
<a name="l187"></a>      </span><span class=cB1>while</span><span class=cB0> (tmpf) </span><span class=cB7>{</span><span class=cB0>
<a name="l188"></a>        </span><span class=cB1>if</span><span class=cB0> (tmpf-&gt;type&amp;</span><span class=cB3>HTT_FUN</span><span class=cB0>) {
<a name="l189"></a>          </span><span class=cB1>if</span><span class=cB0> (dbg_info=tmpf-&gt;dbg_info) </span><span class=cB7>{</span><span class=cB0>
<a name="l190"></a>            </span><span class=cB5>StrCpy</span><span class=cB0>(st,tmpf-&gt;src_link);
<a name="l191"></a>            </span><span class=cB5>StrFirstRem</span><span class=cB0>(st,</span><span class=cB6>&quot;:&quot;</span><span class=cB0>);
<a name="l192"></a>            </span><span class=cB5>StrLastRem</span><span class=cB0>(st,</span><span class=cB6>&quot;,&quot;</span><span class=cB0>);
<a name="l193"></a>            </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>StrCmp</span><span class=cB7>(</span><span class=cB0>st,filename</span><span class=cB7>)</span><span class=cB0>) {
<a name="l194"></a>              </span><span class=cB1>for</span><span class=cB0> (line=dbg_info-&gt;min_line;line&lt;=dbg_info-&gt;max_line;line++)
<a name="l195"></a>                </span><span class=cB1>if</span><span class=cB0> (rip&gt;=IDELineAdd</span><span class=cB7>(</span><span class=cB0>dbg_info,line</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l196"></a>                      rip&lt;IDELineAdd</span><span class=cB7>(</span><span class=cB0>dbg_info,line+1</span><span class=cB7>)</span><span class=cB0>)
<a name="l197"></a>                  </span><span class=cB1>return</span><span class=cB0> line;
<a name="l198"></a>            }
<a name="l199"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l200"></a>        }
<a name="l201"></a>        tmpf=tmpf-&gt;next;
<a name="l202"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l203"></a>    }
<a name="l204"></a>    h=h-&gt;next;
<a name="l205"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l206"></a>  </span><span class=cB1>return</span><span class=cB0> -1;
<a name="l207"></a>}
<a name="l208"></a>
<a name="l209"></a></span><span class=cB1>U0</span><span class=cB0> IDESetStepRange(</span><span class=cB9>CDoc</span><span class=cB0> *doc)
<a name="l210"></a>{
<a name="l211"></a>  </span><span class=cB1>U8</span><span class=cB0> st[256],*filename=doc-&gt;filename.name;
<a name="l212"></a>  </span><span class=cB9>I64</span><span class=cB0> i,line=doc-&gt;cur_entry-&gt;y+1;
<a name="l213"></a>  </span><span class=cB9>CHashTable</span><span class=cB0> *h=</span><span class=cB5>Fs</span><span class=cB0>-&gt;hash_table;
<a name="l214"></a>  </span><span class=cB9>CHashFun</span><span class=cB0> *tmpf;
<a name="l215"></a>  CIDE *tmpi=</span><span class=cB5>FramePtr</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>);
<a name="l216"></a>  </span><span class=cB9>CDbgInfo</span><span class=cB0> *dbg_info;
<a name="l217"></a>  </span><span class=cB1>while</span><span class=cB0> (h) </span><span class=cB7>{</span><span class=cB0>
<a name="l218"></a>    </span><span class=cB1>for</span><span class=cB0> (i=0;i&lt;=h-&gt;mask;i++) {
<a name="l219"></a>      tmpf=h-&gt;body[i];
<a name="l220"></a>      </span><span class=cB1>while</span><span class=cB0> (tmpf) </span><span class=cB7>{</span><span class=cB0>
<a name="l221"></a>        </span><span class=cB1>if</span><span class=cB0> (tmpf-&gt;type&amp;</span><span class=cB3>HTT_FUN</span><span class=cB0>) {
<a name="l222"></a>          </span><span class=cB1>if</span><span class=cB0> (dbg_info=tmpf-&gt;dbg_info) </span><span class=cB7>{</span><span class=cB0>
<a name="l223"></a>            </span><span class=cB5>StrCpy</span><span class=cB0>(st,tmpf-&gt;src_link);
<a name="l224"></a>            </span><span class=cB5>StrFirstRem</span><span class=cB0>(st,</span><span class=cB6>&quot;:&quot;</span><span class=cB0>);
<a name="l225"></a>            </span><span class=cB5>StrLastRem</span><span class=cB0>(st,</span><span class=cB6>&quot;,&quot;</span><span class=cB0>);
<a name="l226"></a>            </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>StrCmp</span><span class=cB7>(</span><span class=cB0>st,filename</span><span class=cB7>)</span><span class=cB0>) {
<a name="l227"></a>              </span><span class=cB1>if</span><span class=cB0> (dbg_info-&gt;min_line&lt;=line&lt;=dbg_info-&gt;max_line) </span><span class=cB7>{</span><span class=cB0>
<a name="l228"></a>                tmpi-&gt;cur_line =IDELineAdd(dbg_info,line);
<a name="l229"></a>                tmpi-&gt;next_line=IDELineAdd(dbg_info,line+1);
<a name="l230"></a>                </span><span class=cB1>return</span><span class=cB0>;
<a name="l231"></a>              </span><span class=cB7>}</span><span class=cB0>
<a name="l232"></a>            }
<a name="l233"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l234"></a>        }
<a name="l235"></a>        tmpf=tmpf-&gt;next;
<a name="l236"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l237"></a>    }
<a name="l238"></a>    h=h-&gt;next;
<a name="l239"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l240"></a>}
<a name="l241"></a>
<a name="l242"></a></span><span class=cB1>U0</span><span class=cB0> IDEToggleBpt(</span><span class=cB9>CDoc</span><span class=cB0> *doc)
<a name="l243"></a>{ </span><span class=cB2>//F9</span><span class=cB0>
<a name="l244"></a>  </span><span class=cB1>U8</span><span class=cB0> st[512],*filename=doc-&gt;filename.name;
<a name="l245"></a>  </span><span class=cB9>I64</span><span class=cB0> i,a,line=doc-&gt;cur_entry-&gt;y+1;
<a name="l246"></a>  </span><span class=cB1>Bool</span><span class=cB0> unlock;
<a name="l247"></a>  </span><span class=cB9>CHashTable</span><span class=cB0> *h=</span><span class=cB5>Fs</span><span class=cB0>-&gt;hash_table;
<a name="l248"></a>  </span><span class=cB9>CHashFun</span><span class=cB0> *tmpf;
<a name="l249"></a>  </span><span class=cB9>CDbgInfo</span><span class=cB0> *dbg_info;
<a name="l250"></a>  </span><span class=cB9>CDocEntry</span><span class=cB0> *doc_e;
<a name="l251"></a>  </span><span class=cB1>while</span><span class=cB0> (h) </span><span class=cB7>{</span><span class=cB0>
<a name="l252"></a>    </span><span class=cB1>for</span><span class=cB0> (i=0;i&lt;=h-&gt;mask;h++) {
<a name="l253"></a>      tmpf=h-&gt;body[i];
<a name="l254"></a>      </span><span class=cB1>while</span><span class=cB0> (tmpf) </span><span class=cB7>{</span><span class=cB0>
<a name="l255"></a>        </span><span class=cB1>if</span><span class=cB0> (tmpf-&gt;type&amp;</span><span class=cB3>HTT_FUN</span><span class=cB0>) {
<a name="l256"></a>          </span><span class=cB1>if</span><span class=cB0> (dbg_info=tmpf-&gt;dbg_info) </span><span class=cB7>{</span><span class=cB0>
<a name="l257"></a>            </span><span class=cB5>StrCpy</span><span class=cB0>(st,tmpf-&gt;src_link);
<a name="l258"></a>            </span><span class=cB5>StrFirstRem</span><span class=cB0>(st,</span><span class=cB6>&quot;:&quot;</span><span class=cB0>);
<a name="l259"></a>            </span><span class=cB5>StrLastRem</span><span class=cB0>(st,</span><span class=cB6>&quot;,&quot;</span><span class=cB0>);
<a name="l260"></a>            </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>StrCmp</span><span class=cB7>(</span><span class=cB0>st,filename</span><span class=cB7>)</span><span class=cB0>) {
<a name="l261"></a>              </span><span class=cB1>if</span><span class=cB0> (dbg_info-&gt;min_line&lt;=line&lt;=dbg_info-&gt;max_line) </span><span class=cB7>{</span><span class=cB0>
<a name="l262"></a>                a=IDELineAdd(dbg_info,line);
<a name="l263"></a>                unlock=</span><span class=cB5>DocLock</span><span class=cB0>(doc);
<a name="l264"></a>                doc_e=doc-&gt;cur_entry;
<a name="l265"></a>                </span><span class=cB1>while</span><span class=cB0> (doc_e-&gt;last-&gt;type_u8!=</span><span class=cB3>DOCT_NEW_LINE</span><span class=cB0> &amp;&amp;
<a name="l266"></a>                      doc_e-&gt;last-&gt;type_u8!=</span><span class=cB3>DOCT_SOFT_NEW_LINE</span><span class=cB0> &amp;&amp;
<a name="l267"></a>                      doc_e-&gt;last!=doc)
<a name="l268"></a>                  doc_e=doc_e-&gt;last;
<a name="l269"></a>                doc-&gt;cur_entry=doc_e;
<a name="l270"></a>                doc-&gt;cur_col=doc_e-&gt;min_col;
<a name="l271"></a>                </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>BptR</span><span class=cB7>(</span><span class=cB0>a,</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task</span><span class=cB7>)</span><span class=cB0>) {
<a name="l272"></a>                  </span><span class=cB5>BptS</span><span class=cB0>(a,</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task);
<a name="l273"></a>                  </span><span class=cB5>DocPrint</span><span class=cB0>(doc,</span><span class=cB6>&quot;$BP$&quot;</span><span class=cB0>);
<a name="l274"></a>                } </span><span class=cB1>else</span><span class=cB0> {
<a name="l275"></a>                  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==DOCT_BPT) </span><span class=cB7>{</span><span class=cB0>
<a name="l276"></a>                    doc-&gt;cur_entry=doc_e-&gt;next;
<a name="l277"></a>                    doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l278"></a>                    </span><span class=cB5>DocEntryDel</span><span class=cB0>(doc,doc_e);
<a name="l279"></a>                  </span><span class=cB7>}</span><span class=cB0>
<a name="l280"></a>                }
<a name="l281"></a>                </span><span class=cB1>if</span><span class=cB0> (unlock)
<a name="l282"></a>                  </span><span class=cB5>DocUnlock</span><span class=cB0>(doc);
<a name="l283"></a>                </span><span class=cB5>DocGoToLine</span><span class=cB0>(doc,line);
<a name="l284"></a>                </span><span class=cB1>return</span><span class=cB0>;
<a name="l285"></a>              </span><span class=cB7>}</span><span class=cB0>
<a name="l286"></a>            }
<a name="l287"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l288"></a>        }
<a name="l289"></a>        tmpf=tmpf-&gt;next;
<a name="l290"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l291"></a>    }
<a name="l292"></a>    h=h-&gt;next;
<a name="l293"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l294"></a>}
<a name="l295"></a>
<a name="l296"></a></span><span class=cB1>U0</span><span class=cB0> IDEClearAllBpts(</span><span class=cB9>CDoc</span><span class=cB0> *doc)
<a name="l297"></a>{ </span><span class=cB2>//SHIFT-F9</span><span class=cB0>
<a name="l298"></a>  </span><span class=cB9>CDocEntry</span><span class=cB0> *doc_e,*doc_e2;
<a name="l299"></a>  </span><span class=cB1>Bool</span><span class=cB0> unlock;
<a name="l300"></a>  IDEWaitParent;
<a name="l301"></a>  </span><span class=cB5>B2</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task);
<a name="l302"></a>  unlock=</span><span class=cB5>DocLock</span><span class=cB0>(doc);
<a name="l303"></a>  doc_e=doc-&gt;head.next;
<a name="l304"></a>  </span><span class=cB1>while</span><span class=cB0> (doc_e!=doc) </span><span class=cB7>{</span><span class=cB0>
<a name="l305"></a>    doc_e2=doc_e-&gt;next;
<a name="l306"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==DOCT_BPT) {
<a name="l307"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e) </span><span class=cB7>{</span><span class=cB0>
<a name="l308"></a>        doc-&gt;cur_entry=doc_e-&gt;next;
<a name="l309"></a>        doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l310"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l311"></a>      </span><span class=cB5>DocEntryDel</span><span class=cB0>(doc,doc_e);
<a name="l312"></a>    }
<a name="l313"></a>    doc_e=doc_e2;
<a name="l314"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l315"></a>  </span><span class=cB1>if</span><span class=cB0> (unlock)
<a name="l316"></a>    </span><span class=cB5>DocUnlock</span><span class=cB0>(doc);
<a name="l317"></a>}
<a name="l318"></a>
<a name="l319"></a></span><span class=cB1>U0</span><span class=cB0> IDEGo()  </span><span class=cB2>//Continue after breakpoint</span><span class=cB0>
<a name="l320"></a>{ </span><span class=cB2>//F5</span><span class=cB0>
<a name="l321"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task;
<a name="l322"></a>  CIDE *tmpi=</span><span class=cB5>FramePtr</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>);
<a name="l323"></a>  </span><span class=cB1>if</span><span class=cB0> (!tmpi) </span><span class=cB7>{</span><span class=cB0>
<a name="l324"></a>    tmpi=</span><span class=cB5>CAlloc</span><span class=cB0>(</span><span class=cB1>sizeof</span><span class=cB7>(</span><span class=cB0>CIDE</span><span class=cB7>)</span><span class=cB0>);
<a name="l325"></a>    </span><span class=cB5>FramePtrAdd</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>,tmpi);
<a name="l326"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l327"></a>  IDEWaitParent;
<a name="l328"></a>  </span><span class=cB5>LBts</span><span class=cB0>(&amp;task-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l329"></a>  tmpi-&gt;cur_line=task-&gt;rip;
<a name="l330"></a>  tmpi-&gt;type=IDET_GO;
<a name="l331"></a>  </span><span class=cB5>LBts</span><span class=cB0>(&amp;task-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l332"></a>  </span><span class=cB5>Suspend</span><span class=cB0>(task,</span><span class=cB3>FALSE</span><span class=cB0>);
<a name="l333"></a>}
<a name="l334"></a>
<a name="l335"></a></span><span class=cB1>U0</span><span class=cB0> IDEStepOver(</span><span class=cB9>CDoc</span><span class=cB0> *doc)
<a name="l336"></a>{ </span><span class=cB2>//F10</span><span class=cB0>
<a name="l337"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task;
<a name="l338"></a>  </span><span class=cB9>I64</span><span class=cB0> line;
<a name="l339"></a>  </span><span class=cB1>U8</span><span class=cB0> *opcode;
<a name="l340"></a>
<a name="l341"></a>  CIDE *tmpi=</span><span class=cB5>FramePtr</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>);
<a name="l342"></a>  </span><span class=cB1>if</span><span class=cB0> (!tmpi) </span><span class=cB7>{</span><span class=cB0>
<a name="l343"></a>    tmpi=</span><span class=cB5>CAlloc</span><span class=cB0>(</span><span class=cB1>sizeof</span><span class=cB7>(</span><span class=cB0>CIDE</span><span class=cB7>)</span><span class=cB0>);
<a name="l344"></a>    </span><span class=cB5>FramePtrAdd</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>,tmpi);
<a name="l345"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l346"></a>
<a name="l347"></a>  IDEWaitParent;
<a name="l348"></a>  line=IDERIPLineNum(doc,task-&gt;rip);
<a name="l349"></a>  </span><span class=cB5>LBts</span><span class=cB0>(&amp;task-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l350"></a>  </span><span class=cB1>if</span><span class=cB0> (line&gt;0) </span><span class=cB7>{</span><span class=cB0>
<a name="l351"></a>    </span><span class=cB5>DocGoToLine</span><span class=cB0>(doc,line);
<a name="l352"></a>    IDESetStepRange(doc);
<a name="l353"></a>  </span><span class=cB7>}</span><span class=cB0> </span><span class=cB1>else</span><span class=cB0> </span><span class=cB7>{</span><span class=cB0>
<a name="l354"></a>    tmpi-&gt;cur_line=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l355"></a>    tmpi-&gt;next_line=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l356"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l357"></a>  tmpi-&gt;type=IDET_STEP_OVER;
<a name="l358"></a>  tmpi-&gt;call_bpt=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l359"></a>
<a name="l360"></a>  </span><span class=cB5>LBts</span><span class=cB0>(&amp;task-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l361"></a>  </span><span class=cB5>Suspend</span><span class=cB0>(task,</span><span class=cB3>FALSE</span><span class=cB0>);
<a name="l362"></a>
<a name="l363"></a>  opcode=task-&gt;rip;
<a name="l364"></a>  </span><span class=cB1>if</span><span class=cB0> (*opcode==</span><span class=cB3>OC_CALL</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l365"></a>    </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>BptS</span><span class=cB7>(</span><span class=cB0>opcode+5,task</span><span class=cB7>)</span><span class=cB0>) {
<a name="l366"></a>      </span><span class=cB1>if</span><span class=cB0> (tmpi-&gt;call_bpt!=opcode+5)
<a name="l367"></a>        tmpi-&gt;existing_bpt=</span><span class=cB3>TRUE</span><span class=cB0>;
<a name="l368"></a>    } </span><span class=cB1>else</span><span class=cB0>
<a name="l369"></a>      tmpi-&gt;existing_bpt=</span><span class=cB3>FALSE</span><span class=cB0>;
<a name="l370"></a>    tmpi-&gt;call_bpt=opcode+5;
<a name="l371"></a>    </span><span class=cB5>LBtr</span><span class=cB0>(&amp;task-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l372"></a>    </span><span class=cB5>LBtr</span><span class=cB0>(&amp;task-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l373"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l374"></a>}
<a name="l375"></a>
<a name="l376"></a></span><span class=cB1>U0</span><span class=cB0> IDEStepInto(</span><span class=cB9>CDoc</span><span class=cB0> *doc)
<a name="l377"></a>{ </span><span class=cB2>//F11</span><span class=cB0>
<a name="l378"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task;
<a name="l379"></a>  </span><span class=cB9>I64</span><span class=cB0> line;
<a name="l380"></a>
<a name="l381"></a>  CIDE *tmpi=</span><span class=cB5>FramePtr</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>);
<a name="l382"></a>  </span><span class=cB1>if</span><span class=cB0> (!tmpi) </span><span class=cB7>{</span><span class=cB0>
<a name="l383"></a>    tmpi=</span><span class=cB5>CAlloc</span><span class=cB0>(</span><span class=cB1>sizeof</span><span class=cB7>(</span><span class=cB0>CIDE</span><span class=cB7>)</span><span class=cB0>);
<a name="l384"></a>    </span><span class=cB5>FramePtrAdd</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>,tmpi);
<a name="l385"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l386"></a>
<a name="l387"></a>  IDEWaitParent;
<a name="l388"></a>  line=IDERIPLineNum(doc,task-&gt;rip);
<a name="l389"></a>  </span><span class=cB5>LBts</span><span class=cB0>(&amp;task-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l390"></a>  </span><span class=cB1>if</span><span class=cB0> (line&gt;0) </span><span class=cB7>{</span><span class=cB0>
<a name="l391"></a>    </span><span class=cB5>DocGoToLine</span><span class=cB0>(doc,line);
<a name="l392"></a>    IDESetStepRange(doc);
<a name="l393"></a>  </span><span class=cB7>}</span><span class=cB0> </span><span class=cB1>else</span><span class=cB0> </span><span class=cB7>{</span><span class=cB0>
<a name="l394"></a>    tmpi-&gt;cur_line=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l395"></a>    tmpi-&gt;next_line=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l396"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l397"></a>  tmpi-&gt;type=IDET_STEP_INTO;
<a name="l398"></a>  </span><span class=cB5>LBts</span><span class=cB0>(&amp;task-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l399"></a>  </span><span class=cB5>Suspend</span><span class=cB0>(task,</span><span class=cB3>FALSE</span><span class=cB0>);
<a name="l400"></a>}
<a name="l401"></a>
<a name="l402"></a></span><span class=cB1>U0</span><span class=cB0> IDEEdTask(</span><span class=cB9>I64</span><span class=cB0>)
<a name="l403"></a>{
<a name="l404"></a>  </span><span class=cB9>CTask</span><span class=cB0> *task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;parent_task,
<a name="l405"></a>        *ed_task=</span><span class=cB3>NULL</span><span class=cB0>,*dbg_task;
<a name="l406"></a>  </span><span class=cB1>U8</span><span class=cB0> *rip=task-&gt;rip,
<a name="l407"></a>        *st,*rip_filename,*bpt_filename;
<a name="l408"></a>  CIDE *tmpi,*tmpi1;
<a name="l409"></a>
<a name="l410"></a>  </span><span class=cB9>CDoc</span><span class=cB0> *doc;
<a name="l411"></a>  </span><span class=cB9>CBpt</span><span class=cB0> *tmpb;
<a name="l412"></a>  </span><span class=cB1>if</span><span class=cB0> (rip_filename=</span><span class=cB5>SrcFileName</span><span class=cB7>(</span><span class=cB0>rip</span><span class=cB7>)</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l413"></a>    ed_task=</span><span class=cB5>Spawn</span><span class=cB0>(&amp;</span><span class=cB5>UserCmdLine</span><span class=cB0>,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Debug&quot;</span><span class=cB0>,,task);
<a name="l414"></a>    </span><span class=cB5>TaskWait</span><span class=cB0>(ed_task);
<a name="l415"></a>    st=MPrint(</span><span class=cB6>&quot;Ed(\&quot;%s\&quot;);\n&quot;</span><span class=cB0>,rip_filename);
<a name="l416"></a>    </span><span class=cB5>XTalkWait</span><span class=cB0>(ed_task,st);
<a name="l417"></a>    </span><span class=cB5>Free</span><span class=cB0>(st);
<a name="l418"></a>    doc=</span><span class=cB5>DocPut</span><span class=cB0>(ed_task);
<a name="l419"></a>    </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>TaskValidate</span><span class=cB7>(</span><span class=cB0>dbg_task=task-&gt;dbg_task</span><span class=cB7>)</span><span class=cB0>) {
<a name="l420"></a>      </span><span class=cB5>WinHorz</span><span class=cB0>(dbg_task-&gt;win_left,dbg_task-&gt;win_right, ed_task);
<a name="l421"></a>      </span><span class=cB5>WinVert</span><span class=cB0>(dbg_task-&gt;win_top, dbg_task-&gt;win_bottom,ed_task);
<a name="l422"></a>      </span><span class=cB1>if</span><span class=cB0> (tmpi=</span><span class=cB5>FramePtr</span><span class=cB7>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>,dbg_task</span><span class=cB7>)</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l423"></a>        tmpi1=</span><span class=cB5>MAllocIdent</span><span class=cB0>(tmpi,ed_task);
<a name="l424"></a>        </span><span class=cB5>FramePtrAdd</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>,tmpi1);
<a name="l425"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l426"></a>      </span><span class=cB5>Kill</span><span class=cB0>(dbg_task);
<a name="l427"></a>    }
<a name="l428"></a>    task-&gt;dbg_task=ed_task;
<a name="l429"></a>    tmpb=task-&gt;bpt_lst;
<a name="l430"></a>    </span><span class=cB1>while</span><span class=cB0> (tmpb) {
<a name="l431"></a>      </span><span class=cB1>if</span><span class=cB0> (bpt_filename=</span><span class=cB5>SrcFileName</span><span class=cB7>(</span><span class=cB0>tmpb-&gt;addr</span><span class=cB7>)</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l432"></a>        </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB5>StrCmp</span><span class=cB7>(</span><span class=cB0>rip_filename,bpt_filename</span><span class=cB7>)</span><span class=cB0>) {
<a name="l433"></a>          </span><span class=cB5>DocGoToLine</span><span class=cB0>(doc,</span><span class=cB5>SrcLineNum</span><span class=cB7>(</span><span class=cB0>tmpb-&gt;addr</span><span class=cB7>)</span><span class=cB0>);
<a name="l434"></a>          </span><span class=cB5>DocPrint</span><span class=cB0>(doc,</span><span class=cB6>&quot;$BP$&quot;</span><span class=cB0>);
<a name="l435"></a>        }
<a name="l436"></a>        </span><span class=cB5>Free</span><span class=cB0>(bpt_filename);
<a name="l437"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l438"></a>      tmpb=tmpb-&gt;next;
<a name="l439"></a>    }
<a name="l440"></a>    </span><span class=cB5>DocGoToLine</span><span class=cB0>(doc,</span><span class=cB5>SrcLineNum</span><span class=cB7>(</span><span class=cB0>rip</span><span class=cB7>)</span><span class=cB0>);
<a name="l441"></a>    </span><span class=cB5>Free</span><span class=cB0>(rip_filename);
<a name="l442"></a>    </span><span class=cB5>StrCpy</span><span class=cB0>(ed_task-&gt;task_title,</span><span class=cB6>&quot;Debug Task&quot;</span><span class=cB0>);
<a name="l443"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l444"></a>}
<a name="l445"></a>
<a name="l446"></a></span><span class=cB1>U0</span><span class=cB0> IDEDbgResume()
<a name="l447"></a>{
<a name="l448"></a>  </span><span class=cB9>CTask</span><span class=cB0> *dbg_task=</span><span class=cB5>Fs</span><span class=cB0>-&gt;dbg_task;
<a name="l449"></a>  CIDE *tmpi=</span><span class=cB5>FramePtr</span><span class=cB0>(</span><span class=cB6>&quot;IDEFrame&quot;</span><span class=cB0>,dbg_task);
<a name="l450"></a>  </span><span class=cB1>U8</span><span class=cB0> *opcode;
<a name="l451"></a>  </span><span class=cB1>if</span><span class=cB0> (!tmpi) </span><span class=cB7>{</span><span class=cB0>
<a name="l452"></a>    </span><span class=cB5>Spawn</span><span class=cB0>(&amp;IDEEdTask,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Dbg Resume&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l453"></a>    </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l454"></a>  </span><span class=cB7>}</span><span class=cB0> </span><span class=cB1>else</span><span class=cB0>
<a name="l455"></a>    </span><span class=cB1>switch</span><span class=cB0> (tmpi-&gt;type) </span><span class=cB7>{</span><span class=cB0>
<a name="l456"></a>      </span><span class=cB1>case</span><span class=cB0> IDET_GO:
<a name="l457"></a>        </span><span class=cB1>if</span><span class=cB0> (tmpi-&gt;cur_line) {
<a name="l458"></a>          </span><span class=cB5>LBtr</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l459"></a>          </span><span class=cB5>LBtr</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l460"></a>          </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>Fs</span><span class=cB0>-&gt;rip==tmpi-&gt;cur_line) </span><span class=cB7>{</span><span class=cB2>//Jmp to self</span><span class=cB0>
<a name="l461"></a>            tmpi-&gt;cur_line=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l462"></a>            </span><span class=cB5>Spawn</span><span class=cB0>(&amp;IDEEdTask,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Dbg Resume&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l463"></a>            </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l464"></a>          </span><span class=cB7>}</span><span class=cB0> </span><span class=cB1>else</span><span class=cB0>
<a name="l465"></a>            tmpi-&gt;cur_line=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l466"></a>        } </span><span class=cB1>else</span><span class=cB0> {
<a name="l467"></a>          </span><span class=cB5>Spawn</span><span class=cB0>(&amp;IDEEdTask,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Dbg Resume&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l468"></a>          </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l469"></a>        }
<a name="l470"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l471"></a>      </span><span class=cB1>case</span><span class=cB0> IDET_STEP_INTO:
<a name="l472"></a>        </span><span class=cB1>if</span><span class=cB0> (!tmpi-&gt;cur_line ||
<a name="l473"></a>              </span><span class=cB5>Fs</span><span class=cB0>-&gt;rip&lt;tmpi-&gt;cur_line || </span><span class=cB5>Fs</span><span class=cB0>-&gt;rip&gt;=tmpi-&gt;next_line) {
<a name="l474"></a>          </span><span class=cB5>Spawn</span><span class=cB0>(&amp;IDEEdTask,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Dbg Resume&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l475"></a>          </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l476"></a>        } </span><span class=cB1>else</span><span class=cB0>
<a name="l477"></a>          </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>,</span><span class=cB3>FALSE</span><span class=cB0>);
<a name="l478"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l479"></a>      </span><span class=cB1>case</span><span class=cB0> IDET_STEP_OVER:
<a name="l480"></a>        </span><span class=cB5>LBts</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l481"></a>        </span><span class=cB5>LBts</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l482"></a>        </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>Fs</span><span class=cB0>-&gt;rip==tmpi-&gt;call_bpt) {
<a name="l483"></a>          </span><span class=cB1>if</span><span class=cB0> (!tmpi-&gt;existing_bpt)
<a name="l484"></a>            </span><span class=cB5>BptR</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>-&gt;rip,</span><span class=cB5>Fs</span><span class=cB0>,</span><span class=cB3>FALSE</span><span class=cB0>);
<a name="l485"></a>          tmpi-&gt;call_bpt=</span><span class=cB3>NULL</span><span class=cB0>;
<a name="l486"></a>        }
<a name="l487"></a>        </span><span class=cB1>if</span><span class=cB0> (!tmpi-&gt;cur_line ||
<a name="l488"></a>              </span><span class=cB5>Fs</span><span class=cB0>-&gt;rip&lt;tmpi-&gt;cur_line || </span><span class=cB5>Fs</span><span class=cB0>-&gt;rip&gt;=tmpi-&gt;next_line) {
<a name="l489"></a>          </span><span class=cB5>Spawn</span><span class=cB0>(&amp;IDEEdTask,</span><span class=cB3>NULL</span><span class=cB0>,</span><span class=cB6>&quot;Dbg Resume&quot;</span><span class=cB0>,,</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l490"></a>          </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>);
<a name="l491"></a>        } </span><span class=cB1>else</span><span class=cB0> {
<a name="l492"></a>          opcode=</span><span class=cB5>Fs</span><span class=cB0>-&gt;rip;
<a name="l493"></a>          </span><span class=cB1>if</span><span class=cB0> (*opcode==</span><span class=cB3>OC_CALL</span><span class=cB0>) </span><span class=cB7>{</span><span class=cB0>
<a name="l494"></a>            </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB5>BptS</span><span class=cB7>(</span><span class=cB0>opcode+5,</span><span class=cB5>Fs</span><span class=cB0>,</span><span class=cB3>FALSE</span><span class=cB7>)</span><span class=cB0>) {
<a name="l495"></a>              </span><span class=cB1>if</span><span class=cB0> (tmpi-&gt;call_bpt!=opcode+5)
<a name="l496"></a>                tmpi-&gt;existing_bpt=</span><span class=cB3>TRUE</span><span class=cB0>;
<a name="l497"></a>            } </span><span class=cB1>else</span><span class=cB0>
<a name="l498"></a>              tmpi-&gt;existing_bpt=</span><span class=cB3>FALSE</span><span class=cB0>;
<a name="l499"></a>            tmpi-&gt;call_bpt=opcode+5;
<a name="l500"></a>            </span><span class=cB5>LBtr</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;task_flags,</span><span class=cB3>TASKf_DISABLE_BPTS</span><span class=cB0>);
<a name="l501"></a>            </span><span class=cB5>LBtr</span><span class=cB0>(&amp;</span><span class=cB5>Fs</span><span class=cB0>-&gt;rflags,</span><span class=cB3>RFLAGf_TRAP</span><span class=cB0>);
<a name="l502"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l503"></a>          </span><span class=cB5>Suspend</span><span class=cB0>(</span><span class=cB5>Fs</span><span class=cB0>,</span><span class=cB3>FALSE</span><span class=cB0>);
<a name="l504"></a>        }
<a name="l505"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l506"></a>    </span><span class=cB7>}</span><span class=cB0>
<a name="l507"></a>}
<a name="l508"></a>
<a name="l509"></a></span><span class=cBB>ext</span><span class=cB0>[</span><span class=cB3>EXT_DBG_RESUME</span><span class=cB0>]=&amp;IDEDbgResume;
<a name="l510"></a>
<a name="l511"></a>#</span><span class=cB1>help_index</span><span class=cB0> </span><span class=cB6>&quot;&quot;</span><span class=cB0>
</span></div></pre></body>
</html>
